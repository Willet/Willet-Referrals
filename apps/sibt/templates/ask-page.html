<html class="WOSIB ask_page">
    <head>
        <title>{% block title %}Ask a Friend{% endblock title %}</title>
        <meta http-equiv="X-UA-Compatible" content="IE=8" />
        <meta http-equiv='Content-Type' content='text/html;charset=utf-8' />

        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
        <script src="/static/js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"></script>
        <link rel="stylesheet" href="/static/css/button.css" type="text/css" />
        <link rel="stylesheet" href="/static/css/smoothness/jquery-ui-1.8.16.custom.css" type="text/css" media="screen" />
        <link rel='icon' type='image/vnd.microsoft.icon' href='/static/imgs/favicon.ico' />

        <script type="text/javascript">
            {% include "../../sibt/templates/js/willet.mediator.js" %}
            {% include "../../sibt/templates/js/willet.debug.js" %}
            {% include "../../sibt/templates/js/willet.loader.js" %}
            {% include "../../sibt/templates/js/willet.analytics.js" %}
        </script>
        <style>
            /* please use hierarchical indentation. */
            .ask_page {
                font-family: Helvetica, Arial, sans-serif;
                }
                .ask_page body {
                    background: #f0f0f0 url("/static/imgs/tiles/diagonal.png");
                    color: #444;
                    margin: 0;
                    padding: 0;
                }
                .ask_page .product {
                    border-radius: 3px;
                }
                .ask_page .width {
                    width: 960px !important; /* override id selectors */
                    margin: 0 auto;
                }
                .ask_page header, .ask_page .header {
                    background: #94B7CF url(/static/imgs/tiles/noise.png);
                    border-bottom: 1px #1C537A solid;
                    box-shadow: 0 8px 11px 0px #DDD;
                    height: 150px;
                    overflow: hidden;
                    padding: 0 0 0 30px;
                    width: 100%;
                }
                .ask_page #oem_panel {
                        color: #fff;
                        text-shadow: 1px 2px 5px #666;
                    }
                    .ask_page #oem_panel>h1 {
                        color: #fff;
                        font-size: 30px;
                        font-weight: bold;
                        margin: 32px 0 16px 0;
                        text-shadow: 1px 2px 5px #666;
                }
                .ask_page #main_content {
                    text-align: center;
                }
                .ask_page #selected_products {
                    margin: 48px 0;
                    }
                    .ask_page #selected_products span {
                        display: inline-block;
                }
                .ask_page #button_container {
                    display: inline-block;
                    margin: 80px 0 0 20px;
                    text-align: left;
                    vertical-align: top;
                }
                .ask_page .selected.product {
                    background-image: url('/static/imgs/dragdrop-here-150x150.png');
                    border: 1px #666 dashed;
                    display: inline-block;
                    margin: 20px;
                    width: 150px;
                    height: 150px;
                }
                .ask_page #available_products {
                    background-color: rgba(120, 120, 120, 0.1);
                    border-radius: 12px;
                    box-shadow: 0px 1px 5px 0px #777777 inset;
                    margin: 0 24px 0;
                    }
                    .ask_page #available_products .product {
                        border: 1px #666 solid;
                        cursor: move;
                        display: inline-block;
                        margin: 18px;

                        width: 120px;
                        height: 120px;
                }
                .ask_page footer, .ask_page .footer {
                    color: #999;
                    font-size: 10px;
                    margin: 24px 0 0 0;
                    text-align: center;
            }
            .invisible {
                display: none;
            }
            .error {
                color: #f00;
                background-color: #fb9;
                border: 1px #ea8 solid;
                border-radius: 6px;
                padding: 10px;
            }
            #sibt_people {
                border: none;
                display: block;
                background-image: url('/static/sibt/imgs/happy-people-245x120.png');
                width: 245px;
                height: 120px;
            }
        </style>

        <!-- Add styles here! Try to reuse as much of ask.css as possible -->
        {% block styles %}{% endblock styles %}
    </head>
    <body>

        <div id="body_wrapper">
            <header class="header">
                <div id="oem_panel" class="width">
                    <img id="sibt_people" alt="Hippie faces"
                         src="/static/sibt/imgs/happy-people-245x120.png"
                         style="float: right; margin: -20px 40px 0 0" />
                    <h1>{{ client.name|default:"Ask a Friend" }}</h1>
                    Which one should you buy? Get your friends' help!
                </div>
            </header>
            <div id="main_content" class="width">
                <h2>Choose two products.</h2>
                <div class="invisible error">Please select two products :)</div>
                <section id="selected_products">
                    <span>
                        Choice A <br/>
                        <img class="selected product" />
                    </span>
                    <span>
                        Choice B <br/>
                        <img class="selected product" />
                    </span>
                    <span id="button_container">
                        <button id="postOnWall" style="display: none">Post vote on Facebook</button>
                        <br/>
                        <button id="chooseFriends" style="display: none">Choose friends to vote</button>
                    </span>
                </section>
                <section id="available_products">
                    <!-- JS -->
                </section>
            </div>
            <footer class="footer">
                &copy; Willet
            </footer>
        </div>

        {% block body_script %}
        <script type="text/javascript">
            window.onerror = function (message, file, line) {
                // improvised error reporting snippet.
                try {
                    var params  = "error=SIBT%20Error" + error +
                                "&script=" + encodeURIComponent(file + ':' + line) +
                                "&st=" + encodeURIComponent(message);
                    (new Image).src = "//{{ DOMAIN }}{% url ClientSideMessage %}?" + params;
                } catch (err) { /* then it's the end of the world :'( */ }
            };

            {# var products = [] #}{% include "products_include.js" %}

            $(document).ready(function () {
                var addAvailableProduct = function (src, uuid, title) {
                    // put a product in the basket of things you can add.
                    var product_elem = $('<img />', {
                        'src': src,
                        'title': title  // mouseover
                    });
                    $('#available_products').prepend(
                        product_elem.addClass('product')
                                    .data('uuid', uuid)
                                    .draggable({revert: true})
                    );
                };

                var getSelectedProductCount = function () {
                    var count = 0,
                        products = $('.selected.product');
                    for (var i = 0; i < products.length; ++i) {
                        if ($(products[i]).data('uuid')) {
                            count++;
                        }
                    }
                    return count;
                };

                // generate a list of available product thingies.
                for (var i = 0; i < products.length; ++i) {
                    addAvailableProduct(products[i].image, products[i].uuid,
                                        products[i].title);
                }

                // set drop targets
                $('.selected.product').droppable({
                    drop: function (event, ui) {
                        var draggedImage = ui.draggable;

                        if ($(this).data('uuid')) {
                            // if dropped into selected product box with
                            // a product already in it, put existing product
                            // back into available products box.
                            addAvailableProduct($(this).attr('src'),
                                                $(this).data('uuid'),
                                                $(this).attr('title'));
                        }

                        $(this).attr({
                            'src': draggedImage.attr('src'),
                            'title': draggedImage.attr('title')
                        }).data('uuid', draggedImage.data('uuid'));

                        // visual cue that you can't add the same product again
                        draggedImage.remove();

                        if (getSelectedProductCount() >= 2) {
                            $('#postOnWall, #chooseFriends').show();
                        }
                    }
                });

                $('#postOnWall, #chooseFriends').click(function () {
                    if (getSelectedProductCount() < 2) {
                        // too few products selected
                        $('.invisible.error')
                            .removeClass('error')
                            .removeAttr('style')  // reset jQ style defs
                            .addClass('error')
                            .show()
                            .animate({
                                'color': '#333',
                                'background-color': '#f0f0f0',
                                'border': '0'
                            }, {
                                'duration': 2500,
                                'complete': function () {
                                    $(this).hide();
                                }
                            });
                        return;
                    }

                    switch ($(this).attr('id')) {
                        case 'postOnWall':

                            break;
                        case 'chooseFriends':

                            break;
                    }
                });
            });
        </script>
        {% endblock body_script %}

        <!-- Google Analytics -->
        <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-23764505-9']);
            _gaq.push(['_trackPageview']);
            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
    </body>
</html>