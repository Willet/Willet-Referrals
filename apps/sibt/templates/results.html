<!DOCTYPE html>
<html lang='en'>
    <head>
       <!-- Google Analytics -->
        <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-23764505-9']);
            _gaq.push(['_trackPageview']);
            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
        
        <!-- Favicon -->
        <link rel='icon' type='image/vnd.microsoft.icon' href='/static/imgs/favicon.ico' />
        
        <meta http-equiv="X-UA-Compatible" content="IE=8" />
        <meta http-equiv='Content-Type' content='text/html;charset=utf-8' />
        <title>Should I Buy This?</title>
        <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
        
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js" type="text/javascript"></script>
        <script src="{{ URL }}/static/js/jquery.timeago.js" type="text/javascript"></script>

        <script type="text/javascript">
            var is_asker = ('{{ is_asker }}' == 'True');
            var is_live = ('{{ is_live }}' == 'True');
            var title;
            $(document).ready(function() {
                $.timeago.settings.allowFuture = true;
                title = $('#title'); 

                if (!is_live) {
                    title.html("Comments"); 
                    $('abbr.timeago').prev('span').html('Voting ended ');
                } else if (is_asker) {
                    title.html("");
                }

                $('iframe').load(function() {
                    $(this).css('width', $('#comments-div').width()); 
                });
                $('abbr.timeago').timeago();
            });
        </script>
        <style type="text/css">
            #wrapper {
                display: inline-block;
                width: 100%;
            }
                #wrapper div {
                    display: inline-block;
                    float: left;
                    font-family: Helvetica, Arial, sans-serif;
                }
                    #wrapper #result {
                        color: #333333;
                        background-color: #ECEFF5;
                        padding: 10px;
                        margin-right: 5%;
                        width:25%;
                        max-width:100px;
                        text-align: center;
                    }
                        #wrapper #result div {
                            margin-top: 1em;
                            width: 100%;
                            margin-bottom: 1em;
                        }
                            #wrapper #result div h1 {
                                margin: auto;
                            }
                    #wrapper #comments-div {
                        width: 75%;
                    }
                        #wrapper #comments-div #fb-comments {
                            width: 100%;
                        }
                            iframe {
                                width: 100% !important;
                            }
        </style>
    </head>
    <body>
    <div id="wrapper">
            <div id="result">
                <div>
                    {% if vote_percentage  %}
                        <h1><span>{{ vote_percentage }}</span>%</h1>
                        say buy it!
                    {% else %}
                        <h3>Nobody has voted yet :(</h3>
                    {% endif %}
                </div>
                <div>
                    <span>Voting ends </span>
                    <abbr class="timeago" title="{{ instance.end_datetime }}"></abbr>
                </div>
            </div>
            <div id="comments-div">
                <h3 id="title">Tell {{ asker_name }} why!</h3>
                <script>
                    window.fbAsyncInit = function() {
                        // see: http://stackoverflow.com/questions/7655352/facebook-comment-fbcomment-returning-https-content-when-called-over-http
                        //FB._https = true;
                        FB.init({
                            appId: '{{FACEBOOK_APP_ID}}', // App ID
                            //channelURL : '//WWW.YOUR_DOMAIN.COM/channel.html', // Channel File
                            status: true, // check login status
                            cookie: true, // enable cookies to allow the server to access the session
                            oauth: true, // enable OAuth 2.0
                            xfbml: true  // parse XFBML
                        });
                    };

                    (function(d, s, id) {
                        var js, fjs = d.getElementsByTagName(s)[0];
                        if (d.getElementById(id)) {return;}
                        js = d.createElement(s);
                        js.id = id;
                        js.async = true;
                        js.src = "https://connect.facebook.net/en_US/all.js#xfbml=1";
                        fjs.parentNode.insertBefore(js, fjs);
                    }(document, 'script', 'facebook-jssdk'));
                </script>
                    
                <div id="fb-root"></div>
                <div id="fb-comments" class="fb-comments hidden" data-width="100%" data-href="{{fb_comments_url}}" data-num-posts="5"></div>
            </div>
        <!--
        <div id="share_again">
            <p>
                Invite a friend to vote: <input style="width: 250px" type="text" readonly="readonly" value="{{ share_url }}" />
            </p>
        </div>
        -->
    </div>
    </body>
</html>
