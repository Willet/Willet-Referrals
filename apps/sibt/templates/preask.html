<!DOCTYPE html>
<html lang='en'>
    <head>
        <!-- Favicon -->
        <link rel='icon' type='image/vnd.microsoft.icon' href='/static/ padding-top: 3px;imgs/favicon.ico' />
        
        <meta http-equiv="X-UA-Compatible" content="IE=8" />
        <meta http-equiv='Content-Type' content='text/html;charset=utf-8' />
        <title>Should I Buy This?</title>
        <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
        <style>       
            @font-face {
                 font-family: fb_font;
                 src: url("/static/fonts/KlavikaBold.otf");
            }
            @font-face {
                 font-family: fb_font;
                 src: url("/static/fonts/KlavikaBold.eot"); /* For IE */
            }
            </style>
        <link rel="stylesheet" href="/static/sibt/css/shopify.css" type="text/css" />
        <link rel="stylesheet" href="/static/sibt/css/ask.css" type="text/css" />
    
    </head>
    <body>
        <div class="wrapper" id="wrapper">

            <!---------------------------- Splash Screen ------------------------------>

            <div id="splash">
                <div class="title_bar">
                    <img alt="logo" src="/static/imgs/sibt_logo_79x50.png" />
                    <div>Ask Your Friends</div>
                    <div class="drop_bar" id="questionOptions">
                        <div class="grey_bar">
                            Should I buy this?
                        </div>
                        <img src="/static/sibt/imgs/drop_arrow_29x29.png" />
                        <ul>
                            <!-- Question options appended when document ready -->
                        </ul>
                    </div>
                </div>
                <div class="message" id="message">
                    <img src="{{ product_image }}" />
                    <textarea>{{ share_text }}</textarea>
                </div>
                <div class="options">
                    <div class="option left">
                        <div class="button" id="postOnWall" title="Post to your wall">
                            <img src="/static/sibt/imgs/sibt_ask_all.png" />
                            <div class="title">Ask Friends</div>
                            <div class="subtitle">Post to Facebook</div>
                        </div>
                        <div class="hint">
                            <img alt="hint arrow" src="/static/sibt/imgs/little_arrow.png" />
                            <div>easy &amp; fast</div>
                        </div>
                    </div>
                    <div class="or">or</div>
                    <div class="option right">
                        <div class="button" id="showChooseScreen" title="Post to your friends' walls">
                            <img src="/static/sibt/imgs/sibt_choose_friends.png" />
                            <div class="title">Choose Friends</div>
                            <div class="subtitle">Get trusted advice</div>
                        </div>
                        <div class="hint">
                            <img alt="hint arrow" src="/static/sibt/imgs/little_arrow.png" />
                            <div>best advice</div>
                        </div>
                    </div>
                </div>
            </div>

            <!---------------------- Choose Friends Screen ------------------------------>

            <div id="choose">
                <div class="title_bar">
                    <img alt="logo" src="/static/imgs/sibt_logo_79x50.png" />
                    <div>Choose Friends To Ask For Advice</div>
                </div>
                <ul class="friends" id="friends">
                    <!-- Friends appended when document ready -->
                </ul>
                <div class="grey_bar" id="add_friend">
                    <img src="/static/sibt/imgs/add_cross_29x29.png" />
                    Add Another Friend
                </div>
                <div class="ask button" onclick='sendMessages();'>
                    <img src="/static/sibt/imgs/sibt_choose_friends.png" />
                    <div class="title">Ask Chosen Friends</div>
                    <div class="subtitle">Giving advice is fun</div>
                </div>
            </div>

            <!--------------------------- Asking Screen -------------------------------->

            <div id="asking">
                <div class="title_bar">
                    <img alt="logo" src="/static/imgs/sibt_logo_79x50.png" />
                    <div>Choose Friends To Ask For Advice</div>
                </div>
                <p id="#nameEntry">Asking...</p>
                <p><img src="/static/imgs/ajax-loader.gif" id="loader" /></p>
            </div>

            <!-------------------------- Success Screen -------------------------------->

            <div id="success">
                <div class="title_bar">
                    <img alt="logo" src="/static/imgs/sibt_logo_79x50.png" />
                    <div>Asks Away!</div>
                </div>
                <div>
                    {% if incentive_enabled %}

                    <p>Your friends have been asked to help by <b>voting</b> on this product.</p><label for="email-field">PayPal Email:</label>
                    <input class="fb_textinput" id="email-field" type="text" value="{{email}}"> </input>
                    
                    <p>We\'ll send you $5 via PayPal immediately after you complete a purchase!</p>
                    
                    <button onclick="updateEmailAddress();" class="cancel-btn" title="Submit PayPal email address">Submit</button>


                    {% else %}
                    
                    <p>Your friends have been asked to help by <b>voting</b> on whether you should buy this product or not.</p>
                    <p>We\'ll email you when someone votes!</p>' );
                    
                    <button onclick="doPostMessage(\'close\');" class="cancel-btn" title="Close">Close</button>

                    {% endif %}
                </div>

            <!------------------------------- End Screens -------------------------------->

        </div>

    <script type="text/javascript" 
               src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <script type="text/javascript">
        // In case the Goog goes down   
        if (typeof jQuery == 'undefined'){
            document.write(unescape("%3Cscript src='/static/js/jquery.min.js' type='text/javascript' charset='utf-8' %3E%3C/script%3E"));
        }
    </script>
    <script src="http://github.com/cowboy/jquery-postmessage/raw/master/jquery.ba-postmessage.js" type="text/javascript"></script>
    <script src="/static/js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"></script>

    <script type="text/javascript">
        "use strict";
        
        var friends        = []; // List of Friend instances in Choose Friend screen
        var fb_friends     = []; // List of { id, name } from FB
        var friendNames    = []; // List of names to use in autocomplete (sorted)
        var selectionCount = 0;  // Number of friends selected to msg
        var fbAccessToken  = "";
        var fbIdentity     = "";
        var options = [
            // Could use template here
            {
                title: 'Should I buy this?',
                text: 'I need help!  Should I buy this? Let me know here:'
            },
            {
                title: 'Does anyone own this?',
                text: 'I need help!  Does anyone own this? Let me know here:'
            }
        ];

        // ----------------------------  CLASSES  ----------------------------------

        // Widget class
        // Base widget, same basic functionality
        var LiWidget = function (name) {
            var elem = this.elem = document.createElement('li');
            elem.id = elem.name = name || '';
        };
        LiWidget.prototype = {
            getElement: function () {
            // Returns HTML element
                return this.elem;
            },
            getName: function () {
            // Returns widget name
                return this.name;
            },
            setVisible: function (i) {
            // sets widget HTML element display
            // true - visible, false - invisible
                if (i) {
                    this.elem.style.display = 'block';
                }
                else {
                    this.elem.style.display = 'none';
                }
            } 
        };

        // A Friend entry in Choose Friends
        // Friend elements are complicated beasts, with much functionality & states
        // For ease, we contain it in this class
        var Friend = function (name) {
            LiWidget.call(this, name);
            this.selected = 'none';
            
            var that = this,
                $elem = $(this.elem);
            
            // Set up DOM
            $elem.addClass('friend').append(" \
                <div class='portrait'> \
                    <img src='/static/sibt/imgs/sibt_choose_friends.png' width=40 height=40 /> \
                </div> \
                <div class='friend_options'> \
                    <div class='fb_option'> \
                    </div> \
                    <div class='or'>or</div> \
                    <div class='email_option'> \
                        <div class='helpful'>Enter a friend's email address</div> \
                        <input></input> \
                    </div> \
                </div> \
            ").find('.email_option input')
                .blur(function () {
                    that._chooseEmailFriendSelect();
                })
                .keypress(function (e) {
                    if (e.which === 13) {
                        that._chooseEmailFriendSelect();
                    }
                });

            $('.email_option input').blur(function () {
                that._chooseEmailFriendSelect();
            })
            .keypress(function (e) {
                if (e.which === 13) {
                    that._chooseEmailFriendSelect();
                }
            });
            
            // Handle two Facebook cases: logged in & no logged in
            var $fb_option = $elem.find('.fb_option');
            if (fbAccessToken !== "" && fbIdentity !== "") {
                $fb_option.append(" \
                    <div class='helpful'>Find a friend using Facebook</div> \
                    <input></input> \
                ").children('input')
                .autocomplete({
                    source: friendNames,
                    // Must use function scope, or else this becomes input element
                    select: this.selectFBFriend,
                    close: function () {
                        that._chooseFBFriendSelect();
                    }
                })
                .keypress(function (e) {
                    if (e.which === 13) {
                        that._chooseFBFriendSelect();
                    }
                });
            } else {
                $fb_option.append(" \
                    <div class='helpful'>The best way to get advice</div> \
                    <div class='fb_connect'>f&nbsp;&nbsp;&nbsp;Connect with Facebook</div> \
                ").children('.fb_connect').click( function () {
                    runFBConnect();
                });
            }
        };
        Friend.prototype = new LiWidget();
        Friend.prototype.getFriendInfo = function () {
            var $elem = $(this.elem);
            // Returns array containing friend info if it exists, else null

            //#### VALIDATE BEFORE DOING THIS STUFF:

            if (this.selected === 'fb') {
                // return name & fb_id
                return [ 'fb',
                         $elem.find('fb_friend input').value, 
                         fb_friends[ $.inArray(name, friendNames) ].id ];
            } else if (this.selected === 'email') {
                // return name & email
                return [ 'email',
                         $elem.find('email_friend input.name').value,
                         $elem.find('email_friend input.email').value ];
            } else {
                return null;
            }
        }
        Friend.prototype._validateFriendEmail = function (el) {
            // Simple validation of friend email in Choose Friend's screen
            if (/^[0-9A-Za-z._%+-]+@[0-9A-Za-z.-]+\.[A-Za-z]{2,6}$/.test(el.value)) {
                // No error
                $(el).css('color','black').siblings('.error').hide();
                $(this.elem).find('.portrait>img').attr('src','/static/sibt/imgs/happy_face.png');
                return true;
            } else {
                // Invalid email address format
                $(el).css('color','red').siblings('.error').show();
                $(this.elem).find('.portrait>img').attr('src','/static/sibt/imgs/sad_face.png');
                return false;
            }
        };
        Friend.prototype._validateFriendName = function (el) {
            // Validation of friend name in Choose Friend's screen
            if (/^[A-Za-z. ]+$/.test(el.value)) {
                // No error
                $(el).css('color','black').siblings('.error').hide();
                $(this.elem).find('.portrait>img').attr('src','/static/sibt/imgs/happy_face.png');
                return true;
            } else {
                // Invalid name format
                $(el).css('color','red').siblings('.error').show();
                $(this.elem).find('.portrait>img').attr('src','/static/sibt/imgs/sad_face.png');
                return false;
            }
        };
        Friend.prototype._validateFriendFB = function (el) {
            // Do a lookup of the Facebook name to check that its valid
            return true;
        };
        Friend.prototype.validateFriendInput = function (el) {
            // Validation of inputs in Choose Friend's screen
            if (el.name === 'email') {
                return this._validateFriendEmail(el);
            } else if (el.name === 'name') {
                return this._validateFriendName(el);
            } else if (el.name === 'fb') {
                return this._validateFriendFB(el);
            } else {
                return false;
            }
        };
        Friend.prototype.selectFBFriend = function(event, ui) {
            // Save selection and change portrait to person
            // ui.item is object
            // this is input element
            var name = ui.item.value,
                i = $.inArray(name, friendNames),
                fb_id = fb_friends[i].id;
            
            $(this).parents('.friend').find('.portrait>img')
                .attr( 'src', 'http://graph.facebook.com/'+ fb_id +'/picture' )
                .attr( 'title', name )
                .attr( 'alt', name );
        };
        Friend.prototype._chooseFBFriendSelect = function () {
            // Change friend select to FB specific in Choose Friend's screen
            var that = this,
                $elem = $(this.elem),
                name = $elem.find('.fb_option input').val();

            this.selected = 'fb';

            // Only do something if there is something in the input field
            if (name !== '') {
                $elem.children('.friend_options').remove();
                $elem.append("\
                    <div class='fb_friend'> \
                        <div> \
                            <label>Name:</label> \
                            <input name='fb' type='text' value='"+name+"'></input> \
                        </div> \
                    </div> \
                ").find('input').autocomplete({
                    source: friendNames,
                    select: this.selectFBFriend
                });
            }
        };
        Friend.prototype._chooseEmailFriendSelect = function () {
            // Change friend select to Email specific in Choose Friend's screen
            var that = this,
                $elem = $(this.elem),
                email = $elem.find('.email_option input').val(),
                name = email.split('@')[0].split('.').join(' ');
            
            this.selected = 'email';

            // Only do something if there is something in the input field
            if (email !== '') {
                $elem.children('.friend_options').remove();
                $elem.append("\
                    <div class='email_friend'> \
                        <div> \
                            <label>Name:</label> \
                            <input class='name' name='name' type='text' value='"+name+"' /> \
                            <div class='error'>Oops, are you sure that's right?</div> \
                        </div> \
                        <div> \
                            <label>Email:</label> \
                            <input class='email' name='email' type='text' value='"+email+"' /> \
                            <div class='error'>Oops, are you sure that's right?</div> \
                        </div> \
                    </div> \
                ").find('input')
                    .blur(function () {
                        that.validateFriendInput(this);
                    })
                    .keypress(function (e) {
                        if (e.which === 13) {
                            that.validateFriendInput(this);
                        }
                    })
                    .each(function () {
                        that.validateFriendInput(this);
                    });
            }
        };
        Friend.prototype.FBLoggedIn = function () {
            var that = this,
                $fb_option = $(this.elem).find('.fb_option');
            $fb_option.children().remove();
            $fb_option.append(" \
                    <div class='helpful'>Find friend using Facebook</div> \
                    <input></input> \
                ").children('input')
                .autocomplete({
                    source: friendNames,
                    select: this.selectFBFriend,
                    close: function () {
                        that._chooseFBFriendSelect();
                    }
                })
                .keypress(function (e) {
                    if (e.which === 13) {
                        that._chooseFBFriendSelect();
                    }
                });
        };

        
        // ------------------------------   AJAX methods  ------------------------------


        var storeAnalytics = function( evnt ) {
            var payload = { what          : evnt,
                            instance_uuid : '',
                            app_uuid      : '{{ app_uuid }}',
                            user_uuid     : '{{ user_uuid }}',
                            target_url    : '{{ target_url }}'
                          };
            $.ajax({
                url      : "{{ URL }}{% url TrackSIBTUserAction %}",
                dataType : 'json',
                data     : payload,
                type     : 'post',
                success  : function (response) {
                    return;
                }
            });
        };
        
        var updateServerUser = function( accessToken, userId ) {
            var payload = { user_uuid   : "{{user_uuid}}",
                        accessToken : accessToken,
                        fbUserId    : userId 
                      };
            $.ajax({
                url      : "{{ URL }}{% url UpdateFBAccessToken %}",
                type     : 'post',
                dataType : 'json',
                data     : payload,
                success  : function (tr) {
                    return;
                }
            });

            fbAccessToken = accessToken;
            fbIdentity    = userId;
        };

        var startPartialInstance = function() {
            var payload = { app_uuid     : "{{app_uuid}}",
                            user_uuid    : "{{user_uuid}}",
                            product_uuid : "{{product_uuid}}",
                            willt_code   : "{{willt_code}}" };
            $.ajax({
                url      : "{{ URL }}{% url StartPartialSIBTInstance %}",
                type     : 'post',
                dataType : 'json',
                data     : payload,
                success  : function (tr) {
                    return;
                }
            });
        };

        var sendMessages = function() {
            var friend_info = [];
            var msg   = $("#share-text").val();

            // Clean up UI to show loader gif
            showScreen('asking');

            // Gather up friend info
            $.each( friends, function (i) { 
                friend_info.push( friends[i].getFriendInfo() );
            });

            payload = { 
                user_uuid       : "{{user_uuid}}",
                app_uuid        : "{{app_uuid}}",
                product_uuid    : "{{product_uuid}}",
                fb_access_token : fbAccessToken,
                fb_id           : fbIdentity,
                friend_info     : friend_info,
                msg             : msg,
                willt_code      : "{{willt_code}}"
            };

            $.ajax({
                url      : "{{ URL }}{% url SendFBMessages %}",
                type     : 'post',
                dataType : 'json',
                data     : payload,
                success  : function (tr) {
                    // Change to success screen
                    showScreen('success');
                }
            });
        };

        var updateEmailAddress = function() {
            var addr = document.getElementById( 'email-field' ).value;
                
            $.ajax({
                url: "/updateEmailAddress",
                type: 'post',
                data: { email : addr },
                success: function (tr) {
                    doPostMessage('close');
                    window.close();
                }
            });
        };
        

        // ------------------------------ PAGE methods ---------------------------------


        var closeIframe = function( action ) {
            if ( action != "" ){
                storeAnalytics( action );
            }

            doPostMessage('close');
            window.close();
        };

        // Post to parent page that we are hosted in
        var doPostMessage = function(message) {
            var target = parent.postMessage ? parent : (parent.document.postMessage ? parent.document : undefined);
            if ( message === "close" ) {
                target.postMessage(
                    message,
                    '{{target_url}}'
                );
            } else {
                $.postMessage( message, '{{target_url}}', parent );
            }
        };

        // Open up the FB dialog. Does not do a FB connect with us.
        var postOnWall = function () {
            startPartialInstance();

            FB.ui({ method:  'feed',
                    display: 'popup',
                    link:    '{{share_url}}',
                    picture: '{{product_images|first}}',
                    name:    "{{product_title|escape}}",
                    caption: '{{store_domain}}',
                    description: "{{ product_desc|striptags|escape }}",
                    redirect_uri: '{{fb_redirect}}' });
            
            closeIframe( 'SIBTNoConnectFBDialog' );
        };

        // Add blank friend entry to Choose Friend's screen
        var addFriend = function () { 
            var friend = new Friend();
            friends.push(friend);
            $('#friends').append(friend.getElement())
                .scrollTo('max', 200, { axis: 'y' });
        };

        // Show or hide list of question options on Splash screen
        // opt - true = show, false = hide
        var toggleShowQuestionOptions = function (opt) {
            $('#questionOptions>ul').toggle(opt);
        };

        // Question to ask has been selected.  Change button text and 
        // close list of options on Splash screen
        var selectQuestionOption = function (num) {
            $('#questionOptions>div').text(options[num].title);
            $('#message>textarea').text(options[num].text);
            toggleShowQuestionOptions();
        };

        // Connect with FB and fetch FB friends, on Choose Friends screen
        var runFBConnect = function () {
            storeAnalytics('SIBTConnectFBDialog');

            FB.login( function(response) {
                var authResp = response.authResponse;

                if (!authResp) {
                    // We weren't given permission, do nothing
                    return;
                } else { 
                    storeAnalytics('SIBTFBConnected');

                    // Store FB data in the server.
                    updateServerUser(authResp.accessToken, authResp.userID);
                    fetchFBFriends();
                }
            }, {scope: 'publish_stream,offline_access,user_about_me,email'});
            // } else {
            // User is logged in AND connected (in theory)
            //     fetchFBFriends( );
            // }
        };

        var showScreen = function (id) {
            $('#wrapper').children().hide();
            $('#wrapper>#'+id).show();
        };
        
        // Query FB api to grab logged-in user's friends
        var fetchFBFriends = function () {
            FB.api( '/me/friends', function (response) {
                fb_friends = response.data;
                fb_friends.sort();

                $.each( response.data, function (i) {
                    friendNames.push(fb_friends[i].name); 
                });

                // Code here changes all FB Connect options into FB Friend Select options
                var i = friends.length;
                while ( i-- ) {
                    friends[i].FBLoggedIn();
                }
           });
        };

        /**
         * jQuery.ScrollTo - Easy element scrolling using jQuery.
         * Copyright (c) 2007-2009 Ariel Flesler - aflesler(at)gmail(dot)com | http://flesler.blogspot.com
         * Dual licensed under MIT and GPL.
         * Date: 5/25/2009
         * @author Ariel Flesler
         * @version 1.4.2
         *
         * http://flesler.blogspot.com/2007/10/jqueryscrollto.html
         */
        (function(d){var k=d.scrollTo=function(a,i,e){d(window).scrollTo(a,i,e)};k.defaults={axis:'xy',duration:parseFloat(d.fn.jquery)>=1.3?0:1};k.window=function(a){return d(window)._scrollable()};d.fn._scrollable=function(){return this.map(function(){var a=this,i=!a.nodeName||d.inArray(a.nodeName.toLowerCase(),['iframe','#document','html','body'])!=-1;if(!i)return a;var e=(a.contentWindow||a).document||a.ownerDocument||a;return d.browser.safari||e.compatMode=='BackCompat'?e.body:e.documentElement})};d.fn.scrollTo=function(n,j,b){if(typeof j=='object'){b=j;j=0}if(typeof b=='function')b={onAfter:b};if(n=='max')n=9e9;b=d.extend({},k.defaults,b);j=j||b.speed||b.duration;b.queue=b.queue&&b.axis.length>1;if(b.queue)j/=2;b.offset=p(b.offset);b.over=p(b.over);return this._scrollable().each(function(){var q=this,r=d(q),f=n,s,g={},u=r.is('html,body');switch(typeof f){case'number':case'string':if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(f)){f=p(f);break}f=d(f,this);case'object':if(f.is||f.style)s=(f=d(f)).offset()}d.each(b.axis.split(''),function(a,i){var e=i=='x'?'Left':'Top',h=e.toLowerCase(),c='scroll'+e,l=q[c],m=k.max(q,i);if(s){g[c]=s[h]+(u?0:l-r.offset()[h]);if(b.margin){g[c]-=parseInt(f.css('margin'+e))||0;g[c]-=parseInt(f.css('border'+e+'Width'))||0}g[c]+=b.offset[h]||0;if(b.over[h])g[c]+=f[i=='x'?'width':'height']()*b.over[h]}else{var o=f[h];g[c]=o.slice&&o.slice(-1)=='%'?parseFloat(o)/100*m:o}if(/^\d+$/.test(g[c]))g[c]=g[c]<=0?0:Math.min(g[c],m);if(!a&&b.queue){if(l!=g[c])t(b.onAfterFirst);delete g[c]}});t(b.onAfter);function t(a){r.animate(g,j,b.easing,a&&function(){a.call(this,n,b)})}}).end()};k.max=function(a,i){var e=i=='x'?'Width':'Height',h='scroll'+e;if(!d(a).is('html,body'))return a[h]-d(a)[e.toLowerCase()]();var c='client'+e,l=a.ownerDocument.documentElement,m=a.ownerDocument.body;return Math.max(l[h],m[h])-Math.min(l[c],m[c])};function p(a){return typeof a=='object'?a:{top:a,left:a}}})(jQuery);
           
        $(document).ready(function() {

            /**********************  ATTACH EVENTS TO DOM HERE  **************************/

            $('.cancel-btn').click(function() {
                doPostMessage('close');
            });
            
            // Close drop down bar if it loses focus
            // Hack because div's dont have blur
            $("body").click(function (evt) {
                 var target = evt.target;
                 if ($(target).parents("#questionOptions").length === 0)  {
                     toggleShowQuestionOptions(false);
                 }
            });

            $('#questionOptions>.grey_bar').click(toggleShowQuestionOptions);

            $('#questionOptions>img').click(toggleShowQuestionOptions);

            $('#postOnWall').click(postOnWall);

            $('#showChooseScreen').click(function () {
                showScreen('choose');
            });

            $('#add_friend').click(addFriend);

            // Load up options
            (function () {
                $ul = $('#questionOptions>ul');
                $.each(options, function (i, opt) {
                    $ul.append("<li onclick='selectQuestionOption("+i+"); >' \
                    "+opt.title+"</li>")
                });
            });

            // Add two Friend instances to Choose Friends screen
            (function () {
                var friend1 = new Friend(),
                    friend2 = new Friend();
                friends.push(friend1, friend2);
                $('#friends').append(friend1.getElement(), friend2.getElement());
            })();

            // OK READY TO GO!
            showScreen('splash');
        });

    </script>

    <div id="fb-root"></div>
    <script>
        window.fbAsyncInit = function() {
            // see: http://stackoverflow.com/questions/7655352/facebook-comment-fbcomment-returning-https-content-when-called-over-http
            //FB._https = true;
            FB.init({
                appId : '{{FACEBOOK_APP_ID}}', // App ID
                //channelURL : '//WWW.YOUR_DOMAIN.COM/channel.html', // Channel File
                status: true, // check login status
                cookie: true, // enable cookies to allow the server to access the session
                oauth : true, // enable OAuth 2.0
                xfbml : true  // parse XFBML
            });
        };

        (function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s);
            js.id = id;
            js.async = true;
            js.src = "https://connect.facebook.net/en_US/all.js#xfbml=1";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script>

    <!-- Google Analytics -->
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-23764505-9']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</body>
</html>

