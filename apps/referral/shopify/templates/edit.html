{% extends "base.html" %}

{% block head %}
    <!-- Guiders stuff -->
    <script src="/static/guiders/jquery-1.5.1.min.js" type="text/javascript"></script>
    <script src="/static/guiders/guiders-1.1.0.js" type="text/javascript"></script>
    <script>
        $(document).ready(function(){
            var toggleDefaultValue;

            toggleDefaultValue = function ($this, onoff) {
                if (onoff) {
                    $this.css('color', 'grey');
                    $this.val($this.siblings('.defaultValue').attr('innerHTML'));
                } else {
                    $this.css('color', 'black');
                    $this.val('');
                }
            } // end function
            
            // Controls default values of input & textarea elements
            $('.defaultValue').siblings('input, textarea').each(
                function () { 
                    var $this = $(this);
                    if ($this.val() === '') {
                        toggleDefaultValue($this, true); 
                    }
                }
            ).focus(
                function () {
                    var $this = $(this),
                        defaultValue = $this.siblings('.defaultValue').attr('innerHTML')
                    if ($this.val() === defaultValue) {
                        toggleDefaultValue($this, false);
                    }
                }
            ).blur(
                function () { 
                    var $this = $(this);
                    if ($this.val() === '' ) {
                        toggleDefaultValue($this, true);
                    }
                }
            );

            // CACHE SOME OBJECTS
            var st = $('#share_text');
            var ct = $('#compose_text');
            $('#step1_right div.wizard input.next').click(function() {
                // go to next wizard step
                var el = $(this);
                var par = el.parent('div.wizard');
                var next = par.next('div.wizard');
                var id = next.children('input.helper:first').attr('id');
                par.hide();
                next.fadeIn();
                st.children('span').removeClass('highlight');
                $('#insert_' + id).addClass('highlight');
            });
            $('#step1_right div.wizard input.first').click(function() {
                // go back to the first
                var el = $(this);
                var par = el.parent('div.wizard');
                var first = par.parent('#step1_right').children('div.wizard:first');
                var id = first.children('input.helper:first').attr('id');
                par.hide();
                first.fadeIn();
                st.children('span').removeClass('highlight');
                $('#insert_' + id).addClass('highlight');
            });
            var updateST = function(this) {
                // update the share text
                var el = $(this);
                var id = el.attr('id');
                var insert = $('#insert_' + id);
                insert.html(el.val());
                st.html(ct.html());
            };
            $('#step1_right input.helper').keypress(function() {
                updateST(this);
            }).keyup(function() {
                updateST(this);
            }).keydown(function() {
                updateST(this);
            }).change(function() {
                updateST(this);
            });
        });
    </script>
    <style type="text/css">
        #compose_text {
            display: block;
            width: 100%;
            background: rgba(245, 252, 253, 0.75);
            border-radius: 5px;
            box-shadow: 0px 1px 5px rgba(0,0,0,0.1);
            padding: 20px;
            font-size: 160%;
        }
        #compose_text span {
            display: inline-block;
            background: #F0F0F0;
            border-radius: 2px;
            padding: 3px 5px 3px 5px;
        }
        #compose_text span.highlight {
            background: #FFF68F;
        }
    </style>
    <link rel="stylesheet" href="/static/guiders/guiders-1.1.0.css" type="text/css" />
{% endblock head %}

{% block left_content %})
   {% include "left_col.html" %}  
{% endblock left_content %}

{% block right_head %}
    <!-- <p><a href="{{logout_url}}">Logout</a></p> -->
    {% if analytics %}
        <p><a href="/r/app/{{app.uuid}}">See Your Referral Analytics</a></p>
    {% endif %}
{% endblock right_head %}

{% block right_content %}
        <div id="step1_right" class="prepend-1 span-14 last left">
            <h2 class="span-15 last lower-75">2. Create Message</h2>
            <p>
                Start out by telling us what you'd like your buyers to share on their social networks. Here's
                what your customers will see:
            </p>
            <form action="/r/shopify/doUpdateOrCreate" class="offer_form" method="post">
                <input type="hidden" name="target_url"   value="{{app.target_url}}" />
                <input type="hidden" name="product_name" value="{{app.product_name}}" />
                <input type="hidden" name="uuid"         value="{{app.uuid}}"  />
                <input type="hidden" name="token"        value="{{store_token}}"  />

                {% if has_app %}
                        <div>
                            <textarea id="share_text" name="share_text">{% if app %}{{app.share_text}}{% endif %}</textarea>
                            <span class="defaultValue hidden" id="share_text_span">I've given you a gift from {{app.product_name}} because ...! Go grab it here: {{app.target_url}}!</span>
                        </div>

                        <input class="call_to_action big submit" id="submit" type="submit" value="Save" title="Save" />
                        
                {% else %}
                    <div class='wizard' id="compose_1">
                        <h3>What type of products does your store specialize in?</h3>
                        <em>eg, socks, shoes, electronics</em>
                        <br />
                        <input type="text" class="helper" id="product" />
                        <input type="button" class="next" value="Next" />
                    </div>
                    <div class='wizard' id="compose_2" style="display: none;">
                        <h3>What is <em>great</em> about your proudcts?</h3>
                        <em>eg, colourful, rare</em>
                        <br />
                        <input type="text" class="helper" id="product_adj" />
                        <input type="button" class="next" value="Next" />
                    </div>
                    <div class='wizard' id="compose_3" style="display: none;">
                        <h3>What is <em>special</em> about your store?</h3>
                        <em>eg, fast delivery, excellent customer service</em>
                        <br />
                        <input type="text" class="helper" id="store_adj" />
                        <input type="button" class="next" value="Next" />
                    </div>
                    <div class='wizard' id="compose_4" style="display: none;">
                        <h3>Happy with your message?</h3>
                        <input class="call_to_action big submit" id="submit" type="submit" value="Save" title="Save" />
                        <input class="first" value="Back to the start" type="button" />
                    </div>
                    <div id="compose_text">
                        I left a free gift at {{STORE_NAME}}. I love their 
                        <span class='highlight' id="insert_product">...</span> because they are
                        <span id="insert_product_adj">...</span> and their store is
                        <span id="insert_store_adj">...</span>.
                    </div>

                    <textarea style="display: none;" id="share_text" name="share_text">{% if app %}{{app.share_text}}{% endif %}</textarea>
                {% endif %}
            </form>
        </div>
{% endblock right_content %}

{% block mixpanelTracking %}
    mpq.push(['track_funnel', 2, 'edit_page']);
{% endblock mixpanelTracking %}
