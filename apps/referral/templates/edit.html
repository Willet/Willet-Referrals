{% extends "base.html" %}

{% block head %}
    <!-- Guiders stuff -->
    <script src="/static/guiders/jquery-1.5.1.min.js" type="text/javascript"></script>
    <script src="/static/guiders/guiders-1.1.0.js" type="text/javascript"></script>
    <script>
        $(document).ready(function(){
            var toggleDefaultValue;

            toggleDefaultValue = function ($this, onoff) {
                if (onoff) {
                    $this.css('color', 'grey');
                    $this.val($this.siblings('.defaultValue').attr('innerHTML'));
                } else {
                    $this.css('color', 'black');
                    $this.val('');
                }
            } // end function
            
            // Controls default values of input & textarea elements
            $('.defaultValue').siblings('input, textarea').each(
                function () { 
                    var $this = $(this);
                    if ($this.val() === '') {
                        toggleDefaultValue($this, true); 
                    }
                }
            ).focus(
                function () {
                    var $this = $(this),
                        defaultValue = $this.siblings('.defaultValue').attr('innerHTML')
                    if ($this.val() === defaultValue) {
                        toggleDefaultValue($this, false);
                    }
                }
            ).blur(
                function () { 
                    var $this = $(this);
                    if ($this.val() === '' ) {
                        toggleDefaultValue($this, true);
                    }
                }
            );
        });

        goToStep1 = function () {
            var step1l = document.getElementById( 'step1_left' );
            var step1r = document.getElementById( 'step1_right' );
            var step2l = document.getElementById( 'step2_left' );
            var step2r = document.getElementById( 'step2_right' );
            var step3l = document.getElementById( 'step3_left' );
            var step3r = document.getElementById( 'step3_right' );
            var btn1   = document.getElementById( 'goToStep1Button' );
            var btn2   = document.getElementById( 'goToStep2Button' );
            var btn3   = document.getElementById( 'goToStep3Button' );

            step1l.style.display="block";
            step1r.style.display="block";
            step2l.style.display="none";
            step2r.style.display="none";
            step3l.style.display="none";
            step3r.style.display="none";
            
            btn1.style.display  ="none";
            btn2.style.display  ="block";
            btn2.innerText      ="Next";
            btn3.style.display  ="none";
        };
        goToStep2 = function () {
            var step1l = document.getElementById( 'step1_left' );
            var step1r = document.getElementById( 'step1_right' );
            var step2l = document.getElementById( 'step2_left' );
            var step2r = document.getElementById( 'step2_right' );
            var step3l = document.getElementById( 'step3_left' );
            var step3r = document.getElementById( 'step3_right' );
            var btn1   = document.getElementById( 'goToStep1Button' );
            var btn2   = document.getElementById( 'goToStep2Button' );
            var btn3   = document.getElementById( 'goToStep3Button' );

            step1l.style.display="none";
            step1r.style.display="none";
            step2l.style.display="block";
            step2r.style.display="block";
            step3l.style.display="none";
            step3r.style.display="none";

            btn1.style.display  ="block";
            btn2.style.display  ="none";
            btn3.style.display  ="block";
        };
        goToStep3 = function () {
            var step1l = document.getElementById( 'step1_left' );
            var step1r = document.getElementById( 'step1_right' );
            var step2l = document.getElementById( 'step2_left' );
            var step2r = document.getElementById( 'step2_right' );
            var step3l = document.getElementById( 'step3_left' );
            var step3r = document.getElementById( 'step3_right' );
            var btn1   = document.getElementById( 'goToStep1Button' );
            var btn2   = document.getElementById( 'goToStep2Button' );
            var btn3   = document.getElementById( 'goToStep3Button' );

            step1l.style.display="none";
            step1r.style.display="none";
            step2l.style.display="none";
            step2r.style.display="none";
            step3l.style.display="block";
            step3r.style.display="block";
            
            btn1.style.display  ="none";
            btn2.innerText      ="Back";
            btn2.style.display  ="block";
            btn3.style.display  ="none";
        };

    </script>
    <link rel="stylesheet" href="/static/guiders/guiders-1.1.0.css" type="text/css" />
{% endblock head %}

{% block left_content %}
    <h1 class="lower-50 center">{% if app %}Edit{% else %}New{% endif %} Campaign</h1>

    <div class="span-8 last center">
        {% if error %} <p class="error"> {{error}} </p> {% endif %}
        <form action="/doUpdateOrCreateCampaign" class="offer_form" method="post">
            <div id="step1_left">
                <div>
                    <label class="default_label" for="title">Name This Campaign</label>
                    <input type="text" id="title" name="title" value="{{app.title|escape}}"/>  <br />
                    <span class="defaultValue hidden">Invite List</span>
                </div>
                <div>
                    <label class="default_label" for="product_name">Your Product / Service Name</label>
                    <input type="text" id="product_name" name="product_name" value="{{app.product_name|escape}}"/>  <br />
                    <span class="defaultValue hidden">FooBoxes</span>
                </div> 
                <div>
                    <label class="default_label" for="target_url">Your Website URL</label> <br />
                    <input type="text" name="target_url" id="target_url" value="{% if app %}{{app.target_url|escape}}{% else %}http://{% endif %}" onBlur="url_text();" />
                </div>
            </div>

            <div id="step2_left" class="hidden">
                <div>
                    <label class="default_label" for="blurb_title">
                        Blurb Title
                    </label> 
                    
                    <br />
                    
                    <input type="text" name="blurb_title" id="blurb_title" value="{% if app %}{{app.blurb_title|escape}}{% endif %}" onKeyUp="update_blurb_title();" />
                    
                    <span class="defaultValue hidden">Get 3 months free</span>
                </div>
                <div>
                    <label class="default_label" for="blurb_text">
                        Blurb Text
                    </label>
                    <br />
                    <textarea name="blurb_text" id="blurb_text" onKeyUp="update_blurb_text();">{% if app %}{{app.blurb_text|escape}}{% endif %}</textarea>
                    
                    <span class="defaultValue hidden">by sharing your love</span>
                </div>
           </div>
            
            <div id="step3_left" class="hidden">
                <div>
                    <label class="default_label" for="share_text">Default Share Text</label>
                    <div id="tweet-counter-left" style="float: right; color: #056380; font-weight: bold;">140</div>
                    <br />
                    <textarea id="share_text" name="share_text" onFocus="update_share_text();" onKeyUp="update_share_text()"; onBlur="update_share_text();">{% if app %}{{app.share_text}}{% endif %}</textarea>
                    <span class="defaultValue hidden" id="share_text_span">I love ReferredU because ...! You should check them out!</span>
                </div>

                <div>
                    <label class="default_label" for="webhook_url">Webhook URL</label> <br />
                    <input type="text" name="webhook_url" id="webhook_url" value="{% if app %}{{app.webhook_url|escape}}{% else %}http://{% endif %}" />
                </div>
                
                {% if client %}
                    <input class="call_to_action big submit" id="submit" type="submit" value="Save & Continue" title="Submit" />
                {% else %}
                    <input class="call_to_action big submit" id="submit" type="submit" value="Login & Continue" title="Login" />
                {% endif %}
            </div>
            
            <input type="hidden" value="{{app.uuid}}" name="uuid" />
        </form>
        
        <button id="goToStep2Button" onClick="goToStep2();" title="Next Step">Next</button>

        <button class="hidden" id="goToStep3Button" onClick="goToStep3();" title="Next Step" >Next</button>
        <button class="hidden" id="goToStep1Button" onClick="goToStep1();" title="Previous Step">Back</button>

    </div>

{% endblock left_content %}

{% block right_head %}
    <p><a href="/account">Your Campaigns</a></p>
{% endblock right_head %}

{% block right_content %}
        <h1 class="span-15 last lower-75 center">Sneak Peek</h1>

        <div id="step1_right" class="prepend-1 span-14 last">
            <p>
                Welcome! It only takes 3 steps to create a Campaign! We'll walk you through it!
            </p>
            <p>
                After entering details about a deal you'd like to track, we'll give you a button.  </p> <p> Add the button to your website and direct your customers to it! It's that simple!  </p> <p> When your customers tweet about your product, we'll track their impact and clickthrough rate.  </p> <p> Visit this site once we have data to view your top influencers!</p> <p> <br /><em>Target your customers with the highest clickthroughs to help with your Internet marketing!</em></p> <br />
            </p>
        </div>

        <div id="step2_right" class="hidden prepend-1 span-14 last">
            <p>
                Here's what your users will be greeted with:
            </p>
            <br />
            <div class="center" id="blurb_iframe_container">
                <iframe src='/widget?ca_id={{app.uuid}}' id="blurb_iframe" scrolling="no" onload="update_blurb_iframe()"></iframe>
            </div>
        </div>
        <div id="step3_right" class="hidden prepend-1 span-14 last">
            <p>
                Here's what your users will be able to edit:
            </p>
            <br />
            <div class="center" id="share_iframe_container">
                <iframe src='/r/shopify/load/referral?app_id={{app.uuid}}' id="share_iframe" scrolling="no" onLoad="update_share_text();"></iframe>
            </div>
        </div>
        
        <div class="center lower-50">
            How it works button? I've removed the guiders.
        </div>
        
        <script>
            // Fill examples
            var i_share_text, i_blurb_title, i_blurb_text, i_twitter_url,
                blurb_title   = document.getElementById('blurb_title'),
                blurb_text    = document.getElementById('blurb_text'),
                share_text    = document.getElementById('share_text'),
                target_url    = document.getElementById('target_url'),
                blurb_i_frame = document.getElementById('blurb_iframe'),
                share_i_frame = document.getElementById('share_iframe');
            
            function update_blurb_title() {
                if (!i_blurb_title) {
                    i_blurb_title= blurb_i_frame.contentWindow.document.getElementById('blurb_title');
                }
                i_blurb_title.innerHTML = blurb_title.value;
            }
            
            function update_blurb_text() {
                if (!i_blurb_text) {
                    i_blurb_text = blurb_i_frame.contentWindow.document.getElementById('blurb_text');
                }
                i_blurb_text.innerHTML = blurb_text.value;
            }
            
            function update_share_text() {
              if (!i_share_text) {
                    i_share_text = share_i_frame.contentWindow.document.getElementById('tf-share-text');
                }
                i_share_text.innerHTML = share_text.value;
            }
            
            function update_blurb_iframe() {
                update_blurb_title();
                update_blurb_text();
            }
            function url_text() {
                document.getElementById('share_text_span').innerText = 'I love ' + target_url.value + ' because ...! You should check them out!';
                $("#share_text").val($("#share_text").siblings('.defaultValue').attr('innerHTML'));

                update_share_text();
            }

        </script>

{% endblock right_content %}

{% block mixpanelTracking %}
    mpq.push(['track_funnel', 2, 'edit_page']);
{% endblock mixpanelTracking %}
