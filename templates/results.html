{% extends "base.html" %}

{% block head %}
    <script type="text/javascript">
        var protocol = document.location.protocol == 'https:' ? 'https:' : 'http:';
        document.write(unescape('%3Cscript src="' + protocol + '//ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js" type="text/javascript"%3E%3C/script%3E'));
        document.write(unescape('%3Cscript src="' + protocol + '//mixpanel.com/site_media/api/platform/platform.1.min.js" type="text/javascript"%3E%3C/script%3E'));
    </script>
    <script type="text/javascript">
        var platform = new Mixpanel.Platform(
            '{{api_key}}',
            '{{platform_secret}}',
            '{{campaign.uuid}}'
        );
        {% if has_results %}
            {{mixpanel}}

            platform.create_pie_chart(
                'pie_chart', [
                    'Email{{campaign.uuid}}',
                    'Twitter{{campaign.uuid}}',
                    'Facebook{{campaign.uuid}}'],{
                    labels: true, 
                    mapping : {
                        'Email{{campaign.uuid}}': 'Email',
                        'Twitter{{campaign.uuid}}': 'Twitter',
                        'Facebook{{campaign.uuid}}' : 'Facebook'
                    }
                }
            );
        {% endif %}

        /*
        platform.create_line_chart( 'graph_div', [ 'Tweets_{{campaign.uuid}}', 
        {% for r in results %} 'Clicks_{{campaign.uuid}}_{{r.user.twitter_handle}}', {% endfor %}
        ], { 'mapping' : { 'Tweets_{{campaign.uuid}}' : 'Tweets',
        {% for r in results %}
            'Clicks_{{campaign.uuid}}_{{r.user.twitter_handle}}' : "{{r.user.twitter_handle}}'s Clickthroughs",
        {% endfor %}
        }, 'legend': false, 'cumulative' : true, 'xlabel' : 'Date', 'ylabel' : 'Counts', interval: 7} );
        */
        /*
        platform.create_line_chart( 'graph_div', [
            'Tweets_{{campaign.uuid}}_BarbaraEMac', 'Clicks_{{campaign.uuid}}_BarbaraEMac'
        ], { 'mapping' : { 'Clicks_{{campaign.uuid}}_BarbaraEMac' : 'BarbaraEMac'}, 'legend' : false, 'cumulative' : true, 'xlabel' : 'Date', 'ylabel' : 'Counts'} );
        */
</script>
{% endblock head %}

{% block content %}
    <div class="span-22 last lower-15" id="right_header">
        <p><a href='{{logout_url}}'>Logout</a></p>
        <p><a href='/account'>Your Campaigns</a></p>
    </div>
    
    <h1 class="span-24 last lower-100 center">Your Referral Results</h1>
    <h2 class="span-24 last center">Campaign: "{{campaign.title|escape}}" for {{campaign.product_name}}</h2>

    {% if has_results %}

        <div class="prepend-2 span-20 append-1 last" id="results">
            <div class="prepend-1 span-17 last append-bottom" id="graph_div" > </div>
         

            <div class="span-20 last" id="pie_chart"> </div>


        </div>
    {% else %}
        <p class="center"> We haven't received any shares or clicks yet. </p>

        <p class="center">In the meantime, watch this funny video (slightly NSFW): </p>

        <div class="prepend-4 span-20 last">
            <script type = "text/javascript" id = "vidyard_embed_code">(function() { var vidyardcontainer =  document.createElement("div"); vidyardcontainer.id = 'vidyard_ybdmFgl8fqtt9iZE7UCrEA'; var vidyardcontainer_s = document.getElementById('vidyard_embed_code'); vidyardcontainer_s.parentNode.insertBefore(vidyardcontainer, vidyardcontainer_s); var vidyard = document.createElement('script'); vidyard.type = 'text/javascript'; vidyard.async = true; vidyard.src = ('https:' == document.location.protocol ? 'https://secure.' : 'http://embed.') + 'vidyard.com/embed/ybdmFgl8fqtt9iZE7UCrEA/iframe/?'; var vidyard_s = document.getElementsByTagName('script')[0]; vidyard_s.parentNode.insertBefore(vidyard, vidyard_s); })();  //embedcodev1.0</script>
        </div>

    {% endif %}
{% endblock content %}
