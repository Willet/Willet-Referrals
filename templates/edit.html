{% extends "base.html" %}

{% block head %}
    <!-- Guiders stuff -->
    <script src="/static/guiders/jquery-1.5.1.min.js" type="text/javascript"></script>
    <script src="/static/guiders/guiders-1.1.0.js" type="text/javascript"></script>
    <script>
        $(document).ready(function(){
            function toggleDefaultValue ($this, onoff) {
                if (onoff) {
                    $this.css('color', 'grey');
                    $this.val($this.siblings('.defaultValue').attr('innerHTML'));
                } else {
                    $this.css('color', 'black');
                    $this.val('');
                }
            } // end function
            
            // Controls default values of input & textarea elements
            $('.defaultValue').siblings('input, textarea').each(
                function () { 
                    var $this = $(this);
                    if ($this.val() === '') {
                        toggleDefaultValue($this, true); 
                    }
                }
            ).focus(
                function () {
                    var $this = $(this),
                        defaultValue = $this.siblings('.defaultValue').attr('innerHTML')
                    if ($this.val() === defaultValue) {
                        toggleDefaultValue($this, false);
                    }
                }
            ).blur(
                function () { 
                    var $this = $(this);
                    if ($this.val() === '' ) {
                        toggleDefaultValue($this, true);
                    }
                }
            );
        });
    </script>
    <link rel="stylesheet" href="/static/guiders/guiders-1.1.0.css" type="text/css" />
{% endblock head %}

{% block left_content %}
    <h1 class="lower-50 center">{% if campaign %}Edit{% else %}New{% endif %} Campaign</h1>

    <div class="span-8 last center">
        {% if error %} <p class="error"> {{error}} </p> {% endif %}
        <form action="/doUpdateOrCreateCampaign" class="offer_form" method="post">
            <div id="bar">
                <label class="default_label" for="title">Name This Campaign</label>
                <input type="text" id="title" name="title" value="{{campaign.title|escape}}"/>  <br />
                <span class="defaultValue hidden">Invite List</span>
            </div>
            <div>
                <label class="default_label" for="button_text">Button Title</label> <br />
                <input type="text" name="button_text" id="button_text" value="{% if campaign %}{{campaign.button_text|escape}}{% endif %}" onKeyUp="button_title_text();" />
                <span class="defaultValue hidden">Get 3 months free</span>
            </div>
            
            <div>
                <label class="default_label" for="button_subtext">Button Subtitle</label> <br />
                <input type="text" name="button_subtext" id="button_subtext" value="{% if campaign %}{{campaign.button_subtext|escape}}{% endif %}" onKeyUp="button_subtitle_text();" />
                <span class="defaultValue hidden">by sharing your love</span>
            </div>
            
            <div>
                <label class="default_label" for="share_text">Default Tweet Text</label>
                <div id="tweet-counter-left" style="float: right; color: #056380; font-weight: bold;">140</div>
                <br />
                <textarea id="share_text" name="share_text" value="" id="share_text" onKeyDown="twitter_text();" onClick="twitter_text()">{% if campaign %}{{campaign.share_text}}{% endif %}</textarea> <br />
                <span class="defaultValue hidden">I love http://www.YOUR_URL_HERE.com because ...! You should check them out!</span>
            </div>
            
            <div>
                <label class="default_label" for="target_url">Target URL</label> <br />
                <input type="text" name="target_url" id="target_url" value="{% if campaign %}{{campaign.target_url|escape}}{% else %}http://{% endif %}" onKeyUp="url_text(); twitter_text();" />
            </div>
            
            <div>
                <label class="default_label" for="webhook_url">Webhook URL</label> <br />
                <input type="text" name="webhook_url" id="webhook_url" value="{% if campaign %}{{campaign.webhook_url|escape}}{% else %}http://{% endif %}" />
            </div>
            
            <div>
                <label class="default_label" for="redirect_url">Redirect URL (Optional)</label> <br />
                <p style="font-size: 1.0em; margin-bottom: 0px;">If you want us to redirect a user to a URL upon a successful Tweet, enter the URL here. Otherwise, the Tweet window will simply close afterwards.</p>
                <input type="text" name="redirect_url" id="redirect_url" value="{% if campaign and campaign.redirect_url %}{{campaign.redirect_url|escape}}{% endif %}" />
                <span class="defaultValue hidden">http://</span>
            </div>

            <input type="hidden" value="{{campaign.uuid}}" name="uuid" />
            
            {% if client %}
                <input class="call_to_action big submit" id="submit" type="submit" value="Save & Continue" title="Submit" />
            {% else %}
                <input class="call_to_action big submit" id="submit" type="submit" value="Login & Continue" title="Login" />
            {% endif %}
        </form>
    </div>

{% endblock left_content %}

{% block right_head %}
    <p><a href="/account">Your Campaigns</a></p>
{% endblock right_head %}

{% block right_content %}
        <h1 class="span-15 last lower-25 center">Sneak Peek</h1>
        <div class="prepend-1 span-14 last">
            <p>
                The embeddable button looks like this:
            </p>
            <div class="tweet_to_action" style="margin: 0 auto;">
                <div id="button_title" class="title">{% if campaign %}{{campaign.button_text|escape}}{% else %}Get 3 months free{% endif %}</div>
                <div id="button_subtitle" class="subtitle">{% if campaign %}{{campaign.button_subtext|escape}}{% else %}by sharing your love{% endif %}</div>
                <div id="button_bird" class="bird"></div>
            </div>
            <br />
            <p class="tip">
                Note: You can use your own button. See code page for details.
            </p>
            <p>
                Here's what your users will see when they open our plugin:
            </p>
            <br />
            <div class="center">
                <iframe src='/twitterPreview' id="twitter-preview" frameBorder="1" 
                        width=500 height=250 style="overflow: hidden;" onload="update_iframe_fields()"></iframe>
            </div>
            <div class="center lower-50">
                <button onClick="guiders.show('first');"> How it Works </button>
            </div>
        </div>
        
        <script>
            // Fill examples
            var i_status, i_twitter_url,
                button_title = document.getElementById('button_title'),
                button_subtitle = document.getElementById('button_subtitle'),
                title_text = document.getElementById('button_text'),
                subtitle_text = document.getElementById('button_subtext'),
                target_url = document.getElementById('target_url'),
                share_text = document.getElementById('share_text'),
                i_frame = document.getElementById('twitter-preview');
            
            function update_text_value(el, val) {
                if (typeof el.innerText !== "undefined") {
                    el.innerText = val;
                } else if (typeof el.textContent !== "undefined") {
                    el.textContent = val;
                }
            }
            
            function button_title_text() {
                update_text_value(button_title, title_text.value);
            }
            
            function button_subtitle_text() {
                update_text_value(button_subtitle, subtitle_text.value);
            }
            
            function twitter_text() {
                var leftVisualCounter = document.getElementById('tweet-counter-left'),
                    remaining = 140,
                    countColor = '#056380',
                    tweet_text = share_text.value;
                if (!i_status) {
                    i_status = i_frame.contentWindow.document.getElementById('status');
                }

                if ( share_text.value.indexOf( target_url.value ) == -1 ) {
                    remaining = 140 - share_text.value.length - target_url.value.length - 1;
                    tweet_text = share_text.value + " " + target_url.value;
                } else {
                    remaining = 140 - share_text.value.length;
                    tweet_text = share_text.value
                }

                leftVisualCounter.innerHTML = remaining;
                if (remaining < 0){
                    countColor = 'pink';
                } else {
                    countColor = '#056380';
                    update_text_value(i_status, tweet_text);
                }
                leftVisualCounter.style.color = countColor;

            };
            
            function url_text() {
                if (!i_twitter_url) {
                    i_twitter_url = i_frame.contentWindow.document.getElementById('twitter_url');
                }
                update_text_value(i_twitter_url, target_url.value);
            };
            
            function update_iframe_fields() {
                twitter_text();
                url_text();
            }
            
           // Guiders.js code
           guiders.createGuider({
              buttons: [{name: "Close"},
                        {name: "Next"}],
              description: "<p> After entering details about a deal you'd like to track, we'll give you a button.  </p> <p> Add the button to your website and direct your customers to it! It's that simple!  </p> <p> When your customers tweet about your product, we'll track their impact and clickthrough rate.  </p> <p> Visit this site once we have data to view your top influencers!</p> <p> <br /><em>Target your customers with the highest clickthroughs to help with your Internet marketing!</em></p> <br />",
              id: "first",
              next: "second",
              overlay: true,
              width: 600,
              title: "How Willet Social Works"
            })
            {% if show_guiders %}
                .show()
            {% endif %};
        
            guiders.createGuider({
              attachTo: "#title",
              buttons: [{name: "Close"},
                        {name: "Next"}],
              description: "Enter some quick details about a URL you'd like to track.",
              id: "second",
              next: "third",
              width: 300,
              position: 3,
              title: "Start a Campaign"
            });
         
            guiders.createGuider({
              attachTo: "#twitter-preview",
              buttons: [{name: "Close"},
                        {name: "Next"}],
              description: "When your customers visit your site and click to open our plugin, here is what they'll see. It looks just like a regular 'Tweet' dialog!",
              id: "third",
              next: "fourth",
              position: 1,
              width: 300,
              title: "Look!"
            });
         
            guiders.createGuider({
              attachTo: "#submit",
              buttons: [{name: "Close"}],
              description: "When you've entered all information, click here and we'll give you a button to put on your website.",
              id: "fourth",
              next: "finally",
              position: 3,
              width: 300,
              title: "All Done!"
            });
        </script>

{% endblock right_content %}
